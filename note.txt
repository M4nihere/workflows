This is code from branch three